<html>

<head>
</head>

<body data-gr-c-s-loaded="true">
  <div style="max-width: 960px;">
    <video-js id="bgPlayerId" data-account="6114089510001" data-player="gijLa9lm" data-embed="default" controls=" "
      data-video-id="" data-playlist-id="" data-application-id=" " class="vjs-fluid">
    </video-js>
  </div>
  <script src="https://players.brightcove.net/6114089510001/gijLa9lm_default/index.min.js"></script>
  <script src="https://players.brightcove.net/videojs-drm/5/videojs-drm.min.js"></script>
  <script>
    var player = videojs.getPlayer('bgPlayerId');
    var asset_id = '0f89a3f8-4195-40e9-bb56-3e70fa21df99';
    var decodeB64ToUint8Array = function decodeB64ToUint8Array(b64Text) {
      var decodedString = window$1.atob(b64Text);
      var array = new Uint8Array(decodedString.length);

      for (var i = 0; i < decodedString.length; i++) {
        array[i] = decodedString.charCodeAt(i);
      }

      return array;
    };
    player.ready(function () {
      player.eme();
      var emeOptions = {
        keySystems: {
          'com.widevine.alpha': {
            vendor: {
              name: 'castlabs',
              options: {
                customDataIsB64: true,
                customData: 'eyJtZXJjaGFudCI6ImJyaWdodGNvdmVfdGVzdGluZyIsInVzZXJJZCI6InJlbnRhbDEiLCJzZXNzaW9uSWQiOiJkZWZhdWx0In0=',
                authToken: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJjcnQiOiJbe1wiYWNjb3VudGluZ0lkXCI6XCJhY2NJZFwiLFwiYXNzZXRJZFwiOlwiMGY4OWEzZjgtNDE5NS00MGU5LWJiNTYtM2U3MGZhMjFkZjk5XCIsXCJwcm9maWxlXCI6e1wicmVudGFsXCI6e1wiYWJzb2x1dGVFeHBpcmF0aW9uXCI6XCIyMDIwLTAzLTAzVDA1OjEwOjAyLjAwMFpcIixcInBsYXlEdXJhdGlvblwiOjEwMDB9fSxcIm91dHB1dFByb3RlY3Rpb25cIjp7XCJkaWdpdGFsXCI6ZmFsc2UsXCJhbmFsb2d1ZVwiOmZhbHNlLFwiZW5mb3JjZVwiOmZhbHNlfX1dIiwiaWF0IjoxNTgzMjEyMTkyLCJqdGkiOiIwYzZkZGY5Zi0xMTk2LTRjY2ItYjczNy0yZDVkMWU4MGYxYWIifQ.KslvLXEb9Q4Un2LrwaslaNEmoh62fgiXWrZWSTyv21f4l-Hom5t5HDd0hZDkZxqp-S_U4h-eErshafO5W_aufw'
              }
            },
            // licenseUri: 'http://localhost:3080/getlicense?id=' + asset_id
            licenseUri: 'https://TVMATP1987D:3443/getlicense?id=' + asset_id
            // licenseUri: 'https://lic.staging.drmtoday.com/license-proxy-widevine/cenc/'
          }
        }
      }
      console.log(player);
      player.src({
        src: 'https://demo.cf.castlabs.com/media/bbb_abr/Manifest_new.mpd',
        type: 'application/dash+xml',
        // keySystems: {
        //   'com.widevine.alpha': {
        //     vendor: {
        //       name: 'castlabs',
        //       options: {
        //         customDataIsB64: true,
        //         customData: 'eyJtZXJjaGFudCI6ImJyaWdodGNvdmVfdGVzdGluZyIsInVzZXJJZCI6InJlbnRhbDEiLCJzZXNzaW9uSWQiOiJkZWZhdWx0In0=',
        //         authToken: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJjcnQiOiJbe1wiYWNjb3VudGluZ0lkXCI6XCJhY2NJZFwiLFwiYXNzZXRJZFwiOlwiMGY4OWEzZjgtNDE5NS00MGU5LWJiNTYtM2U3MGZhMjFkZjk5XCIsXCJwcm9maWxlXCI6e1wicmVudGFsXCI6e1wiYWJzb2x1dGVFeHBpcmF0aW9uXCI6XCIyMDIwLTAzLTAzVDA1OjEwOjAyLjAwMFpcIixcInBsYXlEdXJhdGlvblwiOjEwMDB9fSxcIm91dHB1dFByb3RlY3Rpb25cIjp7XCJkaWdpdGFsXCI6ZmFsc2UsXCJhbmFsb2d1ZVwiOmZhbHNlLFwiZW5mb3JjZVwiOmZhbHNlfX1dIiwiaWF0IjoxNTgzMjEyMTkyLCJqdGkiOiIwYzZkZGY5Zi0xMTk2LTRjY2ItYjczNy0yZDVkMWU4MGYxYWIifQ.KslvLXEb9Q4Un2LrwaslaNEmoh62fgiXWrZWSTyv21f4l-Hom5t5HDd0hZDkZxqp-S_U4h-eErshafO5W_aufw'
        //       }
        //     },
        //     // licenseUri: 'http://localhost:3080/getlicense?id=' + asset_id
        //     licenseUri: 'https://TVMATP1987D:3443/getlicense?id=' + asset_id
        //     // licenseUri: 'https://lic.staging.drmtoday.com/license-proxy-widevine/cenc/'
        //   }
        // }
        keySystems: {
          'com.widevine.alpha': {
            // audioContentType: 'audio/webm; codecs="vorbis"',
            // videoContentType: 'video/webm; codecs="vp9"',
            // getCertificate: function (emeOptions, callback) {
            //   console.log("*****");
            //   // request certificate
            //   // if err, callback(err)
            //   // if success, callback(null, certificate)
            // },
            getLicense: function (emeOptions, keyMessage, callback) {
              let body = new TextDecoder().decode(keyMessage)
              let request = JSON.parse(body);
              console.log(request);
              // console.assert(request.kids.length === 1);

              // let keyObj = {
              //   kty: 'oct',
              //   alg: 'A128KW',
              //   kid: request.kids[0],
              //   k: toBase64(KEY)
              // };

              // console.log('Key object:', keyObj);

              // callback(null, new TextEncoder().encode(JSON.stringify({
              //   keys: [keyObj]
              // })));
              let xhr = new XMLHttpRequest();
              xhr.open('POST', 'http://localhost:3080/getlicense?id=' + keyMessage)
              xhr.send(keyMessage)
                // request license
                // if err, callback(err)
                // if success, callback(null, license)
              //   , function (err, response, responseBody) {
              //     if (err) {
              //       callback(err);
              //       return;
              //     }
              //     var lic = decodeB64ToUint8Array(responseBody.license);
              //     callback(null, lic);
              //   }
            }
          }
        }
      });
    });
  </script>
</body>

</html>