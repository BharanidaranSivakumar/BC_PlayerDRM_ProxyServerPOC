<html>

<head>
</head>

<body data-gr-c-s-loaded="true">
  <div style="max-width: 960px;">
    <video-js id="bgPlayerId" data-account="6114089510001" data-player="gijLa9lm" data-embed="default" controls=" "
      data-video-id="" data-playlist-id="" data-application-id=" " class="vjs-fluid">
    </video-js>
  </div>
  <script src="https://players.brightcove.net/6114089510001/gijLa9lm_default/index.min.js"></script>
  <script src="https://players.brightcove.net/videojs-drm/5/videojs-drm.min.js"></script>
  <script>
    var player = videojs.getPlayer('bgPlayerId');
    var systemIp;
    window.RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;//compatibility for Firefox and chrome
    var pc = new RTCPeerConnection({ iceServers: [] }), noop = function () { };
    pc.createDataChannel('');
    pc.createOffer(pc.setLocalDescription.bind(pc), noop);
    pc.onicecandidate = function (ice) {
      if (ice && ice.candidate && ice.candidate.candidate) {
        var myIP = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ice.candidate.candidate)[1];
        systemIp = myIP;
        pc.onicecandidate = noop;
      }
    };
    var decodeB64ToUint8Array = function decodeB64ToUint8Array(b64Text) {
      var decodedString = window.atob(b64Text);
      var array = new Uint8Array(decodedString.length);

      for (var i = 0; i < decodedString.length; i++) {
        array[i] = decodedString.charCodeAt(i);
      }

      return array;
    };

    player.ready(function () {
      player.eme();
      var emeOptions = {}
      player.src({
        src: 'https://demo.cf.castlabs.com/media/bbb_abr/Manifest_new.mpd',
        type: 'application/dash+xml',
        keySystems: {
          'com.widevine.alpha': {
            getLicense: function (emeOptions, keyMessage, callback) {
              let reqBody = {
                ipaddress: systemIp,
                accountId: '6114089510001',
                videoId: '6133692125001',
                body: new TextDecoder().decode(keyMessage)
              };
              videojs.xhr({
                uri: 'https://TVMATP1987D:3443/getlicense',
                method: 'POST',
                responseType: 'json',
                body: JSON.stringify(reqBody),
                headers: {
                  'Content-type': 'application/json'
                }
              }, function (err, response, responseBody) {
                if (err) {
                  callback(err);
                  return;
                }
                var lab = decodeB64ToUint8Array(responseBody.license);
                callback(null, lab);
              });
            }
          }
        }
      });
    });
  </script>
</body>

</html>